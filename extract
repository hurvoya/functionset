# On extrait proprement les client_id à exclure
wholesale_client_ids = set(df_wholesale["client_id"].dropna().unique())


client_to_siren = (
    df_client.loc[df_client["client_siren"].notna(), ["client_id", "client_siren"]]
    .drop_duplicates("client_id")
    .set_index("client_id")["client_siren"]
)


# On récupère les SIREN correspondant aux client_id wholesale
sirens_with_wholesale = client_to_siren.loc[
    client_to_siren.index.intersection(wholesale_client_ids)
]

sirens_with_wholesale = set(sirens_with_wholesale.values)


tiers_flags["flg_not_wholesale"] = (
    ~tiers_flags["SIREN"].isin(sirens_with_wholesale)
).astype(int)
