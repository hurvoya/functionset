df['DT_STATUS_CHANGE'] = pd.to_datetime(df['DT_STATUS_CHANGE'], errors='coerce')
df['End date'] = pd.to_datetime(df['End date'], errors='coerce')


def flag_mel_valide(row):
    cod_status_major = str(row['COD_STATUS_MAJOR'])
    dt_status_change = row['DT_STATUS_CHANGE']
    end_date = row['End date']

    if len(cod_status_major.strip()) < 1 or pd.isna(cod_status_major):
        return 0

    if pd.notnull(dt_status_change) and pd.notnull(end_date):
        days_diff = (end_date - dt_status_change).days
        if days_diff > 30:
            return 0

    return 1

# Appliquer la fonction
df['FlagMELValide'] = df.apply(flag_mel_valide, axis=1)
