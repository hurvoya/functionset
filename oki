import matplotlib.pyplot as plt
import seaborn as sns

def plot_stats(df_stats, threshold):
    variables = df_stats['variable'].unique()
    for var in variables:
        for stat in ['nb_de_RAV', 'success_rate']:
            plt.figure(figsize=(12, 6))
            data = df_stats[(df_stats['variable'] == var) & (df_stats['Stats'] == stat) & (df_stats['below_threshold'] == 0)]
            
            # Determine the unique sorted values for 'valeur_variable'
            sorted_hue_values = sorted(data['valeur_variable'].unique())
            
            sns.lineplot(data=data, x='annee_mois', y='valeur', hue='valeur_variable', hue_order=sorted_hue_values, marker='o')
            plt.title(f'{stat} over time for variable {var}')
            plt.xlabel('Mois-Annee')
            plt.ylabel(stat)
            plt.xticks(rotation=45)
            
            # Improve x-axis label formatting
            plt.gca().xaxis.set_major_locator(plt.MaxNLocator(nbins=10))  # Limit number of x-ticks
            
            plt.tight_layout()
            plt.show()

plot_stats(df_stats, threshold)
