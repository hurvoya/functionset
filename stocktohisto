Un contrat est en vie pour un mois de stock M si et seulement si :

date_debut < 1er jour du mois M

date_fin â‰¥ 1er jour du mois M + 1 mois

ðŸ’¡ Donc :

Il faut que le contrat ait commencÃ© avant le mois, pas pendant.

Et quâ€™il soit encore actif aprÃ¨s la fin du mois, donc fin â‰¥ 1er du mois suivant.

On exclut les NaT en date_fin (ils ne sont pas traitÃ©s).



# Groupement par id_client pour compter le nombre de contrats
df_doublons = df.groupby("id_client")["id_contrat"].nunique()

# On garde ceux qui ont plus dâ€™un contrat
df_doublons = df_doublons[df_doublons > 1].reset_index()
df_doublons.columns = ["id_client", "nb_contrats"]

df_contrats_doublons = df[df["id_client"].isin(df_doublons["id_client"])]
