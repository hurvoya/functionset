events_no_ka = events[events["is_key_account"] == False]

kpi_new_dealer_type = (
    events_no_ka
    .assign(
        year_month=events_no_ka["date_new_dealer"].dt.to_period("M").astype(str)
    )
    .groupby(["country", "year_month", "new_dealer_type"])
    .agg(
        nb_new_dealers=("id_apporteur", "nunique")
    )
    .reset_index()
)
