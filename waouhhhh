dfc_x = dfc_x.copy()

dfc_x["rolling_max_fin_prev"] = (
    dfc_x.groupby(["country", "id_apporteur"])["dte_fin_contrat"]
          .cummax()
          .shift(1)
)

print(dfc_x[["country", "id_contract", "dte_mel", "dte_fin_contrat", "rolling_max_fin_prev"]])
