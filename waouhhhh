summary_bloc8 = (
    df8
    .groupby(["country", "year", "dealer_category"])
    .agg(nb_events=("event_key", "nunique"))
    .reset_index()
)

# Total par pays/ann√©e
totals = (
    summary_bloc8
    .groupby(["country", "year"], as_index=False)
    .agg(total_events=("nb_events", "sum"))
)

summary_bloc8 = summary_bloc8.merge(
    totals,
    on=["country", "year"],
    how="left"
)

summary_bloc8["share"] = summary_bloc8["nb_events"] / summary_bloc8["total_events"]
