def apply_eg_cooldown(events_candidates: pd.DataFrame, cooldown_months: int = 6) -> pd.DataFrame:
    ev = events_candidates.copy()
    ev["event_date"] = pd.to_datetime(ev["event_date"], errors="coerce")
    ev = ev[ev["event_date"].notna()].copy()
    ev = ev.sort_values(["country", "ibl", "id_apporteur", "event_date"])

    kept_rows = []
    last_event = {}

    for r in ev.itertuples(index=False):
        key = (r.country, r.ibl, r.id_apporteur)
        d = r.event_date

        if key not in last_event:
            kept_rows.append(r)
            last_event[key] = d
        else:
            # si on est encore dans la fenêtre de suivi EG => on ignore
            if d <= (last_event[key] + pd.DateOffset(months=cooldown_months)):
                continue
            kept_rows.append(r)
            last_event[key] = d

    out = pd.DataFrame(kept_rows, columns=ev.columns)

    # event_id stable par dealer (séquentiel)
    out = out.sort_values(["country", "ibl", "id_apporteur", "event_date"])
    out["event_id"] = out.groupby(["country", "ibl", "id_apporteur"]).cumcount() + 1

    return out

