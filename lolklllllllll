cand_yoy = df_feat[
    (~df_feat["in_nd_window"]) &
    (~df_feat["new_dealer_like"]) &
    (df_feat["prod_6m"] >= PROD_MIN) &
    (df_feat["growth_yoy"] >= GROWTH_MIN)
].copy()

cand_yoy = cand_yoy.sort_values(["id_apporteur", "dte_mel", "id_contract"])
print("YoY candidates rows:", len(cand_yoy), "dealers:", cand_yoy["id_apporteur"].nunique())
