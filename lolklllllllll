df = events.copy()

# 1. Filtre années
df["year"] = df["dte_event"].dt.year
df = df[df["year"].isin([2024, 2025])]

# 2. Création libellé KA
df["ka_type"] = df["is_key_account"].map({
    True: "Key Account",
    False: "Non-Key Account"
})

# 3. Agrégation
kpi_bloc1 = (
    df.groupby(["country", "year", "ka_type"])
      .size()
      .reset_index(name="nb_dealers")
)
