def exclude_new_dealers(existing_df, nd_windows):
    df = existing_df.merge(
        nd_windows[[
            "id_apporteur",
            "nd_start",
            "nd_end"
        ]],
        on="id_apporteur",
        how="left"
    )

    df["in_nd_window"] = (
        (df["snapshot_date"] >= df["nd_start"]) &
        (df["snapshot_date"] <= df["nd_end"])
    )

    df = df[~df["in_nd_window"]].copy()
    df.drop(columns=["nd_start", "nd_end", "in_nd_window"], inplace=True)

    return df
